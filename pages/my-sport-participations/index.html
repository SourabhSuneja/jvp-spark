<!DOCTYPE html>
<html lang="en" class="noselect">
   <head>
      <!-- Google tag (gtag.js) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-T7R00N5VLE"></script>
      <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());
         
         gtag('config', 'G-T7R00N5VLE');
      </script>
      <!-- Google tag (gtag.js) -->
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>My Sport Participations</title>
      <script type="module" src="https://myjvp.in/commons/supabase-crud.js"></script>
      <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
      <style>
         :root {
         --primary: #1a237e;
         --secondary: #283593;
         --text-dark: #333;
         --text-light: #666;
         --bg-light: #f4f6f9;
         --white: #ffffff;
         --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
         /* House Colors - Default */
         --house-color: #6c757d; 
         --house-bg: #e9ecef;
         }
         /* House Specific Overrides */
         body.house-Emerald { --house-color: #27ae60; --house-bg: #e8f8f0; }
         body.house-Ruby { --house-color: #c0392b; --house-bg: #f9ebeb; }
         body.house-Sapphire { --house-color: #2980b9; --house-bg: #eaf4fb; }
         body.house-Topaz { --house-color: #f39c12; --house-bg: #fef9e7; }
         * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; max-height: 999999px; }
         .noselect {
         -webkit-user-select: none;
         -moz-user-select: none;
         -ms-user-select: none;
         user-select: none;
         -webkit-touch-callout: none;
         -webkit-user-drag: none;
         -webkit-tap-highlight-color: transparent;
         }
         body { background-color: var(--bg-light); color: var(--text-dark); padding-bottom: 40px; }
         /* Header */
         header {
         background: linear-gradient(135deg, var(--primary), var(--secondary));
         color: var(--white);
         padding: 2rem 1rem;
         text-align: center;
         border-bottom-left-radius: 30px;
         border-bottom-right-radius: 30px;
         box-shadow: var(--shadow);
         position: relative;
         }
         .school-name { font-size: 0.9rem; letter-spacing: 1px; opacity: 0.9; text-transform: uppercase; }
         .event-title { font-size: 1.8rem; font-weight: 700; margin-top: 5px; }
         .year-tag { background: rgba(255,255,255,0.2); padding: 2px 10px; border-radius: 15px; font-size: 0.8rem; }
         /* Container */
         .container { max-width: 800px; margin: -40px auto 0; padding: 0 1.5rem; position: relative; z-index: 10; }
         /* Student Profile Card */
         .profile-card {
         background: var(--white);
         border-radius: 20px;
         padding: 2rem;
         text-align: center;
         box-shadow: var(--shadow);
         border-top: 5px solid var(--house-color);
         margin-bottom: 2rem;
         margin-top: 18px;
         }
         .avatar-placeholder {
         width: 80px; height: 80px;
         background: var(--house-bg);
         color: var(--house-color);
         border-radius: 50%;
         display: flex; align-items: center; justify-content: center;
         font-size: 2rem; margin: 0 auto 1rem;
         border: 2px solid var(--house-color);
         }
         .student-name { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; }
         .student-details {
         display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;
         margin-top: 10px;
         }
         .badge {
         padding: 5px 15px; border-radius: 20px; font-size: 0.85rem; font-weight: 500;
         display: flex; align-items: center; gap: 5px;
         }
         .badge-house { background-color: var(--house-bg); color: var(--house-color); }
         .badge-class { background-color: #f0f0f0; color: #555; }
         /* Section Titles */
         .section-title {
         font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-light);
         display: flex; align-items: center; gap: 10px;
         }
         .section-title i { color: var(--house-color); }
         /* Event Cards */
         .events-grid { display: grid; gap: 1.5rem; }
         .event-card {
         background: var(--white); border-radius: 15px; overflow: hidden;
         box-shadow: var(--shadow); transition: transform 0.2s;
         border-left: 4px solid transparent;
         }
         .event-card.type-Individual { border-left-color: #9b59b6; }
         .event-card.type-Grouped { border-left-color: #e67e22; }
         .event-card.type-Team { border-left-color: #3498db; }
         .event-header {
         padding: 1rem 1.5rem; border-bottom: 1px solid #eee;
         display: flex; justify-content: space-between; align-items: center;
         }
         .event-name { font-weight: 600; font-size: 1.1rem; color: var(--primary); }
         .event-type-badge { font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; background: #eee; color: #666; }
         .event-body { padding: 1.5rem; }
         .info-row { display: flex; gap: 20px; margin-bottom: 10px; font-size: 0.9rem; color: var(--text-light); }
         .info-item i { width: 20px; text-align: center; margin-right: 5px; color: var(--secondary); }
         .teammates-section {
         margin-top: 1rem; background: #f8f9fa; padding: 1rem; border-radius: 10px;
         }
         .teammates-label { font-size: 0.8rem; font-weight: 600; margin-bottom: 5px; color: #888; text-transform: uppercase; }
         .teammates-list { display: flex; flex-wrap: wrap; gap: 8px; }
         .mate-chip {
         background: var(--white); border: 1px solid #e0e0e0;
         padding: 4px 10px; border-radius: 15px; font-size: 0.8rem;
         }
         /* Rules & Footer */
         .rules-box {
         background: #fff3cd; border: 1px solid #ffeeba; color: #856404;
         padding: 1.5rem; border-radius: 15px; margin-top: 2rem;
         }
         .rules-title { font-weight: 600; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 8px; }
         li {
         margin-top: 12px;
         }
         .qr-reminder {
         text-align: center; margin-top: 2rem; padding: 2rem;
         background: var(--white); border-radius: 20px; box-shadow: var(--shadow); display: none;
         }
         .qr-icon { font-size: 3rem; color: var(--primary); margin-bottom: 1rem; }
         /* Loading/Error States */
         #loading, #error-msg { text-align: center; padding: 4rem 1rem; }
         #app-content { display: none; }
         /* Mobile Optimization */
         @media (max-width: 600px) {
         .event-header { flex-direction: column; align-items: flex-start; gap: 5px; }
         .info-row { flex-direction: column; gap: 5px; }
         }
         /* Developer Credits */
         .dev-credits {
         text-align: center;
         margin-top: 3rem;
         padding-top: 2rem;
         border-top: 1px dashed #ddd;
         color: var(--text-light);
         font-size: 0.85rem;
         }
         .dev-credits h4 {
         color: var(--primary);
         font-size: 1rem;
         margin-bottom: 5px;
         font-weight: 600;
         }
         .dev-credits p {
         margin-bottom: 5px;
         }
         .dev-name {
         color: var(--secondary);
         font-weight: 700;
         position: relative;
         display: inline-block;
         }
         /* Optional: Adds a subtle decorative underline to the name */
         .dev-name::after {
         content: '';
         position: absolute;
         width: 100%;
         height: 2px;
         bottom: -2px;
         left: 0;
         background-color: var(--house-color); /* Dynamically changes with House theme */
         opacity: 0.5;
         }
      </style>
   </head>
   <body>
      <div id="loading">
         <i class="fas fa-spinner fa-spin fa-2x" style="color: var(--primary);"></i>
         <p style="margin-top: 1rem;">Verifying Identity...</p>
      </div>
      <div id="error-msg" style="display: none;">
         <i class="fas fa-exclamation-circle fa-3x" style="color: #c0392b;"></i>
         <h2 style="margin: 1rem 0;">Access Denied</h2>
         <p>We could not find student records associated with this QR code.</p>
      </div>
      <div id="app-content">
         <header>
            <div class="school-name">Jamna Vidyapeeth</div>
            <div class="event-title">Annual Sports Meet</div>
            <span class="year-tag">2025-26</span>
         </header>
         <div class="container">
            <div class="profile-card">
               <div class="avatar-placeholder">
                  <i class="fas fa-user"></i>
               </div>
               <h1 class="student-name" id="display-name">--</h1>
               <div class="student-details">
                  <div class="badge badge-class">
                     <i class="fas fa-graduation-cap"></i> <span id="display-class">--</span>
                  </div>
                  <div class="badge badge-house">
                     <i class="fas fa-shield-alt"></i> House <span id="display-house">--</span>
                  </div>
               </div>
            </div>
            <div class="section-title">
               <i class="fas fa-running"></i> Your Events
            </div>
            <div class="events-grid" id="events-list">
            </div>
            <div class="rules-box">
               <div class="rules-title"><i class="fas fa-balance-scale"></i> Fair Play Policy</div>
               <ul style="padding-left: 20px; font-size: 0.9rem; line-height: 1.6;">
               <li>Play with integrity. Unfair practices will lead to immediate disqualification of the student or the entire House.</li>
               <li>You are allowed to participate only in the events listed above.<br>However, there are certain games not listed here and will be played for recreation only (such as Tug of War, Carrom, Skates etc). You may be a participant in such games but they are not reflected here. Such games will not count towards house results.</li>
               <li style="display: none">Do not share your QR code with any other student. Sharing may result in disqualification for both students.</li>
               <li>Respect the referees and the opposing teams.</li>
               <li>Report to the school ground on time.</li>
            </div>
            <div class="qr-reminder">
               <i class="fas fa-qrcode qr-icon"></i>
               <h3>Entry Pass Required</h3>
               <p style="color: #666; margin-top: 0.5rem; font-size: 0.9rem;">
                  Please keep this QR code handy and intact. Your housemasters will instruct you where to paste it on your T-shirt or blazer.<br><br>
                  <strong>No entry allowed without QR verification at the venue.</strong>
               </p>
            </div>
            <div class="dev-credits">
               <h4><i class="fas fa-code"></i> System Credits</h4>
               <p>QR-based Winner Tracker & Live Score System</p>
               <p>Concept & Development by <span class="dev-name">Mr. Sourabh Suneja</span></p>
            </div>
         </div>
      </div>
      <script>
         // 1. Mock Data Implementation
         let GLOBAL_DATA = [];
         
         // 2. Fetch Logic
         async function fetchParticipationData(token) {
             try {
                 const data = await invokeFunction ('get_student_participations_definer_variant', {'p_access_token': token});
                 if(data) {
                      GLOBAL_DATA = data; 
                      const studentEvents = GLOBAL_DATA.filter(item => item.access_token === token);
                     if (studentEvents.length > 0) {
                         return studentEvents;
                     } else {
                         return false;
                     }
                 }
             } catch(e) {
                 console.error(e.message);
                 return false;
             }
         }
         
         // 3. Helper: Find Teammates
         function getTeammates(eventId, groupId, currentStudentId) {
             return GLOBAL_DATA.filter(item => 
                 item.event_id === eventId && 
                 item.participant_group_id === groupId && 
                 item.student_id !== currentStudentId
             );
         }
         
         // 4. Main App Logic
         async function initializePage(userData) {
             let token = userData.access_token;
             
             // If no token provided in URL, return with error
             if (!token) {
                 console.error("No token found.");
                 document.getElementById('loading').style.display = 'none';
                 document.getElementById('error-msg').style.display = 'block';
                 return;
             }
         
             try {
                 const data = await fetchParticipationData(token);
             renderStudentData(data);
             } catch (error) {
                 document.getElementById('loading').style.display = 'none';
                 document.getElementById('error-msg').style.display = 'block';
             }
         }
         
         function renderStudentData(events) {
             // Basic Info (taken from first event record)
             const profile = events[0];
             
             document.getElementById('display-name').textContent = profile.student_name;
             document.getElementById('display-class').textContent = profile.student_class;
             document.getElementById('display-house').textContent = profile.student_house;
         
             // Apply House Theme
             document.body.classList.add(`house-${profile.student_house}`);
         
             const eventsContainer = document.getElementById('events-list');
             
             // Build Event Cards
             events.forEach(event => {
                 const isSolo = event.game_type === 'Individual';
                 
                 // Find teammates if not solo
                 let teammatesHTML = '';
                 if (!isSolo) {
                     const teammates = getTeammates(event.event_id, event.participant_group_id, profile.student_id);
                     if (teammates.length > 0) {
                         const teammateChips = teammates.map(tm => `<div class="mate-chip">${tm.student_name} (${tm.student_class})</div>`).join('');
                         const labelText = event.game_type === 'Team' ? 'Team Members' : 'Group Partner(s)';
                         
                         teammatesHTML = `
                             <div class="teammates-section">
                                 <div class="teammates-label">${labelText}</div>
                                 <div class="teammates-list">
                                     ${teammateChips}
                                 </div>
                             </div>
                         `;
                     }
                 }
         
                 const cardHTML = `
                     <div class="event-card type-${event.game_type}">
                         <div class="event-header">
                             <div class="event-name">${event.game_name}</div>
                             <div class="event-type-badge">${event.game_type} Event</div>
                         </div>
                         <div class="event-body">
                             <div class="info-row">
                                 <div class="info-item"><i class="fas fa-layer-group"></i> Category: Class ${event.class_category}</div>
                                 <div class="info-item"><i class="fas fa-venus-mars"></i> Gender: ${event.gender_filter}</div>
                             </div>
                             ${teammatesHTML}
                         </div>
                     </div>
                 `;
                 eventsContainer.innerHTML += cardHTML;
             });
         
             // Switch Views
             document.getElementById('loading').style.display = 'none';
             document.getElementById('app-content').style.display = 'block';
         }
         
      </script>
   </body>
</html>