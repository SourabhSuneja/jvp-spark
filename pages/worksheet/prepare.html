<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Processing Worksheet</title>
      <!-- font awesome icons link -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
      <!-- ion icons link -->
      <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
      <style>
         :root {
         /* Colors - Dark Theme */
         --bg-primary: #121212;
         --bg-secondary: #1f1f1f;
         --bg-tertiary: #333333;
         --bg-gradient-dark: linear-gradient(145deg, #1e1e1e, #333333);
         --bg-input: #2c2c2c;
         --bg-profile: rgb(25, 25, 25);
         /* Text Colors - Dark Theme */
         --text-primary: #fff;
         --text-secondary: #ddd;
         --text-tertiary: #b0bec5;
         --text-muted: rgb(230, 230, 230);
         --text-light-gray: rgb(240, 240, 240);
         --text-dark-gray: rgb(220, 220, 220);
         /* Accent Colors */
         --accent-primary: #ffc107;
         --accent-hover: #e0a800;
         --accent-focus: #ffd54f;
         --accent-button-text: black;
         /* Logout button specific â€” remain same for light and dark themes */
         --logout-bg: #e53935;
         --logout-text: #fff;
         --logout-hover: #d32f2f;
         /* Status Colors */
         --error-color: #FF3333;
         --error-bg: #e53935;
         --error-hover: #d32f2f;
         /* Overlay Colors */
         --overlay-bg: rgba(0, 0, 0, 0.5);
         --loading-overlay-bg: black;
         --loading-credits-color: rgb(245, 245, 245);
         /* Scrollbar Colors */
         --scrollbar-thumb: rgb(50, 50, 50);
         --scrollbar-track: transparent;
         /* Shadow Colors */
         --shadow-dark: rgba(0, 0, 0, 0.5);
         --shadow-medium: rgba(0, 0, 0, 0.6);
         --shadow-light: rgba(0, 0, 0, 0.4);
         /* Spacing Values */
         --spacing-xs: 4px;
         --spacing-sm: 8px;
         --spacing-md: 12px;
         --spacing-lg: 16px;
         --spacing-xl: 20px;
         --spacing-xxl: 25px;
         --spacing-xxxl: 30px;
         /* Border Radius */
         --radius-sm: 5px;
         --radius-md: 8px;
         --radius-lg: 10px;
         --radius-xl: 12px;
         --radius-full: 50%;
         /* Font Sizes */
         --font-sm: 0.9rem;
         --font-base: 1rem;
         --font-md: 1.1rem;
         --font-lg: 1.2rem;
         --font-xl: 1.6rem;
         --font-xxl: 1.7rem;
         --font-xxxl: 1.8rem;
         --font-icon-sm: 1.2rem;
         --font-icon-md: 1.8rem;
         --font-icon-lg: 2.1rem;
         --font-icon-xl: 64px;
         /* Transitions */
         --transition-fast: 0.2s ease;
         --transition-base: 0.3s ease;
         --transition-slow: 0.4s all;
         --transition-slower: 0.5s;
         /* Z-index */
         --z-overlay: 1;
         --z-header: 10;
         --z-sidebar: 20;
         --z-signin: 99999;
         --z-loading: 500000;
         /* Dimensions */
         --sidebar-width: 260px;
         --avatar-sm: 40px;
         --avatar-md: 70px;
         --avatar-lg: 80px;
         --scrollbar-width: 6px;
         }
         /* Light theme overrides */
         body.light-theme {
         --bg-primary: #ffffff;
         --bg-secondary: rgb(253, 253, 253);
         --bg-tertiary: rgb(240, 240, 240);
         --bg-gradient-dark: linear-gradient(145deg, #ffffff, #f0f0f0);
         --bg-input: #ffffff;
         --bg-profile: rgb(253, 253, 253);
         --text-primary: #333;
         --text-secondary: rgb(50, 50, 50);
         --text-tertiary: rgb(80, 80, 80);
         --text-muted: #333;
         --text-light-gray: rgb(50, 50, 50);
         --text-dark-gray: rgb(90, 90, 90);
         --accent-button-text: rgb(30, 30, 30);
         --error-color: #d32f2f;
         --error-bg: #ff6666;
         --error-hover: #ff4d4d;
         --loading-overlay-bg: rgb(253, 253, 253);
         --loading-credits-color: rgb(50, 50, 50);
         --scrollbar-thumb: rgb(170, 170, 170);
         --shadow-dark: rgba(0, 0, 0, 0.1);
         --shadow-medium: rgba(0, 0, 0, 0.1);
         --shadow-light: rgba(0, 0, 0, 0.1);
         }
         * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
         font-family: 'Roboto', sans-serif;
         max-height: 999999px;
         transition: var(--transition-base) all;
         }
         .noselect {
         -webkit-user-select: none;
         -moz-user-select: none;
         -ms-user-select: none;
         user-select: none;
         -webkit-touch-callout: none;
         -webkit-user-drag: none;
         -webkit-tap-highlight-color: transparent;
         }
         body {
         display: flex;
         height: 100vh;
         background-color: var(--bg-primary);
         color: var(--text-primary);
         overflow: hidden;
         margin: 0;
         padding-top: env(safe-area-inset-top);
         padding-left: env(safe-area-inset-left);
         padding-right: env(safe-area-inset-right);
         padding-bottom: env(safe-area-inset-bottom);
         }
         .container {
         width: 100%;
         height: 100%;
         display: flex;
         align-items: center;
         justify-content: center;
         overflow-y: auto;
         padding: var(--spacing-xl);
         }
         /* Input Form Styles */
         .input-form-container {
         width: 100%;
         max-width: 500px;
         display: flex;
         flex-direction: column;
         }
         .form-header {
         text-align: center;
         margin-bottom: var(--spacing-xxxl);
         }
         .form-title {
         font-size: var(--font-xxl);
         font-weight: 700;
         color: var(--text-primary);
         margin-bottom: var(--spacing-md);
         }
         .form-subtitle {
         font-size: var(--font-md);
         color: var(--text-tertiary);
         }
         .form-content {
         background-color: var(--bg-secondary);
         border-radius: var(--radius-lg);
         padding: var(--spacing-xxl);
         box-shadow: 0 4px 12px var(--shadow-medium);
         }
         .input-group {
         margin-bottom: var(--spacing-xl);
         }
         .input-group:last-of-type {
         margin-bottom: 0;
         }
         .input-label {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: var(--spacing-sm);
         font-size: var(--font-md);
         font-weight: 700;
         color: var(--text-primary);
         }
         .input-max {
         font-size: var(--font-sm);
         color: var(--text-tertiary);
         font-weight: 400;
         }
         .input-field {
         width: 100%;
         padding: var(--spacing-md) var(--spacing-lg);
         background-color: var(--bg-input);
         border: 2px solid var(--bg-tertiary);
         border-radius: var(--radius-md);
         color: var(--text-primary);
         font-size: var(--font-base);
         outline: none;
         transition: border-color var(--transition-base);
         }
         .input-field:focus {
         border-color: var(--accent-primary);
         }
         .input-field::-webkit-outer-spin-button,
         .input-field::-webkit-inner-spin-button {
         -webkit-appearance: none;
         margin: 0;
         }
         .input-field[type=number] {
         -moz-appearance: textfield;
         }
         .error-message {
         display: none;
         margin-top: var(--spacing-sm);
         font-size: var(--font-sm);
         color: var(--error-color);
         }
         .error-message.show {
         display: block;
         }
         .button-container {
         margin-top: var(--spacing-xxl);
         display: flex;
         gap: var(--spacing-md);
         }
         .btn {
         flex: 1;
         padding: var(--spacing-md) var(--spacing-xl);
         border: none;
         border-radius: var(--radius-md);
         font-size: var(--font-md);
         font-weight: 700;
         cursor: pointer;
         transition: all var(--transition-base);
         outline: none;
         }
         .btn-primary {
         background-color: var(--accent-primary);
         color: var(--accent-button-text);
         }
         .btn-primary:hover {
         background-color: var(--accent-hover);
         transform: translateY(-1px);
         box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
         }
         .btn-primary:active {
         transform: translateY(0);
         }
         .btn-primary:disabled {
         opacity: 0.5;
         cursor: not-allowed;
         transform: none;
         }
         /* Processing Animation Styles */
         .processing-container {
         display: none;
         flex-direction: column;
         align-items: center;
         justify-content: center;
         width: 100%;
         height: 100%;
         }
         .processing-container.show {
         display: flex;
         }
         .worksheet-animation {
         position: relative;
         width: 200px;
         height: 200px;
         margin-bottom: var(--spacing-xxxl);
         }
         .worksheet-icon {
         position: absolute;
         top: 50%;
         left: 50%;
         transform: translate(-50%, -50%);
         font-size: var(--font-icon-xl);
         color: var(--accent-primary);
         animation: pulse 2s ease-in-out infinite;
         }
         .orbit-container {
         position: absolute;
         top: 50%;
         left: 50%;
         width: 100%;
         height: 100%;
         transform: translate(-50%, -50%);
         animation: rotate 3s linear infinite;
         }
         .orbit-dot {
         position: absolute;
         width: 12px;
         height: 12px;
         background-color: var(--accent-primary);
         border-radius: var(--radius-full);
         box-shadow: 0 0 15px var(--accent-primary);
         }
         .orbit-dot:nth-child(1) {
         top: 0;
         left: 50%;
         transform: translateX(-50%);
         animation: dotPulse 1.5s ease-in-out infinite;
         }
         .orbit-dot:nth-child(2) {
         bottom: 0;
         left: 50%;
         transform: translateX(-50%);
         animation: dotPulse 1.5s ease-in-out 0.5s infinite;
         }
         .orbit-dot:nth-child(3) {
         top: 50%;
         left: 0;
         transform: translateY(-50%);
         animation: dotPulse 1.5s ease-in-out 1s infinite;
         }
         .orbit-dot:nth-child(4) {
         top: 50%;
         right: 0;
         transform: translateY(-50%);
         animation: dotPulse 1.5s ease-in-out 1.5s infinite;
         }
         .processing-text {
         font-size: var(--font-xl);
         font-weight: 700;
         color: var(--text-primary);
         margin-bottom: var(--spacing-md);
         text-align: center;
         }
         .processing-subtext {
         font-size: var(--font-md);
         color: var(--text-tertiary);
         text-align: center;
         margin-bottom: var(--spacing-xxl);
         }
         .progress-container {
         width: 100%;
         max-width: 400px;
         height: 6px;
         background-color: var(--bg-tertiary);
         border-radius: var(--radius-sm);
         overflow: hidden;
         box-shadow: inset 0 2px 4px var(--shadow-light);
         }
         .progress-bar {
         height: 100%;
         background: linear-gradient(90deg, var(--accent-primary), var(--accent-focus));
         border-radius: var(--radius-sm);
         animation: progressAnimation 2s ease-in-out infinite;
         box-shadow: 0 0 10px var(--accent-primary);
         }
         .status-indicators {
         display: flex;
         gap: var(--spacing-lg);
         margin-top: var(--spacing-xxxl);
         flex-wrap: wrap;
         justify-content: center;
         }
         .status-item {
         display: flex;
         align-items: center;
         gap: var(--spacing-sm);
         padding: var(--spacing-md) var(--spacing-lg);
         background-color: var(--bg-secondary);
         border-radius: var(--radius-md);
         font-size: var(--font-sm);
         color: var(--text-secondary);
         box-shadow: 0 2px 6px var(--shadow-light);
         }
         .status-item i {
         font-size: var(--font-icon-sm);
         color: var(--accent-primary);
         animation: fadeInOut 2s ease-in-out infinite;
         }
         .status-item:nth-child(2) i {
         animation-delay: 0.7s;
         }
         .status-item:nth-child(3) i {
         animation-delay: 1.4s;
         }
         @keyframes pulse {
         0%, 100% {
         transform: translate(-50%, -50%) scale(1);
         opacity: 1;
         }
         50% {
         transform: translate(-50%, -50%) scale(1.1);
         opacity: 0.8;
         }
         }
         @keyframes rotate {
         0% {
         transform: translate(-50%, -50%) rotate(0deg);
         }
         100% {
         transform: translate(-50%, -50%) rotate(360deg);
         }
         }
         @keyframes dotPulse {
         0%, 100% {
         transform: scale(1);
         opacity: 1;
         }
         50% {
         transform: scale(1.5);
         opacity: 0.6;
         }
         }
         @keyframes progressAnimation {
         0% {
         width: 0%;
         }
         50% {
         width: 70%;
         }
         100% {
         width: 100%;
         }
         }
         @keyframes fadeInOut {
         0%, 100% {
         opacity: 0.3;
         }
         50% {
         opacity: 1;
         }
         }
         /* Responsive adjustments */
         @media (max-width: 768px) {
         .form-content {
         padding: var(--spacing-lg);
         }
         .worksheet-animation {
         width: 150px;
         height: 150px;
         }
         .worksheet-icon {
         font-size: 48px;
         }
         .processing-text {
         font-size: var(--font-lg);
         }
         .processing-subtext {
         font-size: var(--font-base);
         }
         .status-indicators {
         gap: var(--spacing-sm);
         }
         .status-item {
         padding: var(--spacing-sm) var(--spacing-md);
         font-size: 0.85rem;
         }
         }
         @media (max-width: 480px) {
         .input-form-container {
         max-width: 100%;
         }
         .form-title {
         font-size: var(--font-xl);
         }
         .worksheet-animation {
         width: 120px;
         height: 120px;
         }
         .worksheet-icon {
         font-size: 40px;
         }
         .orbit-dot {
         width: 8px;
         height: 8px;
         }
         .progress-container {
         max-width: 300px;
         }
         }
         /* Scrollbar Styling */
         .container::-webkit-scrollbar {
         width: var(--scrollbar-width);
         }
         .container::-webkit-scrollbar-track {
         background: var(--scrollbar-track);
         }
         .container::-webkit-scrollbar-thumb {
         background: var(--scrollbar-thumb);
         border-radius: var(--radius-sm);
         }
      </style>
   </head>
   <body>
      <div class="container">
         <!-- Input Form -->
         <div class="input-form-container" id="inputForm">
            <div class="form-header">
               <h1 class="form-title">Configure Your Worksheet</h1>
               <p class="form-subtitle">Select the number of questions for each type</p>
            </div>
            <div class="form-content">
               <form id="questionForm">
                  <div id="inputFields">
                     <!-- Dynamic input fields will be generated here -->
                  </div>
                  <div class="button-container">
                     <button type="submit" class="btn btn-primary">
                     Generate Worksheet
                     </button>
                  </div>
               </form>
            </div>
         </div>
         <!-- Processing Animation -->
         <div class="processing-container" id="processingAnimation">
            <div class="worksheet-animation">
               <i class="fas fa-file-alt worksheet-icon"></i>
               <div class="orbit-container">
                  <div class="orbit-dot"></div>
                  <div class="orbit-dot"></div>
                  <div class="orbit-dot"></div>
                  <div class="orbit-dot"></div>
               </div>
            </div>
            <div class="processing-text">Preparing Your Worksheet</div>
            <div class="processing-subtext">This will only take a moment...</div>
            <div class="progress-container">
               <div class="progress-bar"></div>
            </div>
            <div class="status-indicators">
               <div class="status-item">
                  <i class="fas fa-sync-alt"></i>
                  <span>Processing</span>
               </div>
               <div class="status-item">
                  <i class="fas fa-check-circle"></i>
                  <span>Formatting</span>
               </div>
               <div class="status-item">
                  <i class="fas fa-download"></i>
                  <span>Finalizing</span>
               </div>
            </div>
         </div>
      </div>
      <script>
         let qbDetails = [];
         
         let selectedQbIds = []; 
         
         let subject, grade;
         
         // Calculate available question types and their maximum counts
         function calculateAvailableQuestions() {
           const availableQuestions = {};
           
           // Filter selected question banks
           const selectedBanks = qbDetails.filter(qb => selectedQbIds.includes(qb.id));
           
           // Aggregate question counts by type
           selectedBanks.forEach(qb => {
             Object.keys(qb.question_count).forEach(type => {
               if (type !== 'Total' && qb.question_count[type] > 0) {
                 availableQuestions[type] = (availableQuestions[type] || 0) + qb.question_count[type];
               }
             });
           });
           
           return availableQuestions;
         }
         
         // Generate input fields dynamically
         function generateInputFields() {
           const availableQuestions = calculateAvailableQuestions();
           const inputFieldsContainer = document.getElementById('inputFields');
           
           Object.keys(availableQuestions).forEach(questionType => {
             const maxCount = availableQuestions[questionType];
             
             const inputGroup = document.createElement('div');
             inputGroup.className = 'input-group';
             
             inputGroup.innerHTML = `
               <label class="input-label">
                 <span>${questionType}</span>
                 <span class="input-max">Max: ${maxCount}</span>
               </label>
               <input 
                 type="number" 
                 class="input-field" 
                 id="input-${questionType}"
                 name="${questionType}"
                 min="0" 
                 max="${maxCount}" 
                 value="0"
                 data-max="${maxCount}"
                 required
               >
               <div class="error-message" id="error-${questionType}"></div>
             `;
             
             inputFieldsContainer.appendChild(inputGroup);
           });
         }
         
         // Validate input
         function validateInput(input) {
           const value = parseInt(input.value) || 0;
           const max = parseInt(input.getAttribute('data-max'));
           const errorElement = document.getElementById(`error-${input.name}`);
           
           if (value < 0) {
             errorElement.textContent = 'Value cannot be negative';
             errorElement.classList.add('show');
             return false;
           }
           
           if (value > max) {
             errorElement.textContent = `Maximum ${max} questions available`;
             errorElement.classList.add('show');
             return false;
           }
           
           errorElement.classList.remove('show');
           return true;
         }
         
         // Handle form submission
         function handleFormSubmit(event) {
           event.preventDefault();
           
           const form = event.target;
           const inputs = form.querySelectorAll('.input-field');
           let isValid = true;
           const selectedQuestions = {};
           
           inputs.forEach(input => {
             if (!validateInput(input)) {
               isValid = false;
             } else {
               const value = parseInt(input.value) || 0;
               if (value > 0) {
                 selectedQuestions[input.name] = value;
               }
             }
           });
           
           // Check if at least one question type is selected
           if (isValid && Object.keys(selectedQuestions).length === 0) {
             alert('Please select at least one question type with a quantity greater than 0');
             return;
           }
           
           if (isValid) {
             // Hide form and show processing animation
             document.getElementById('inputForm').style.display = 'none';
             document.getElementById('processingAnimation').classList.add('show');
             
             // Call the generateWorksheet function
             if (typeof generateWorksheet === 'function') {
               generateWorksheet(selectedQuestions);
             } else {
               console.log('generateWorksheet function not found. Selected questions:', selectedQuestions);
             }
           }
         }
         
         // Add input validation listeners
         function addInputListeners() {
           const inputs = document.querySelectorAll('.input-field');
           inputs.forEach(input => {
             input.addEventListener('blur', () => validateInput(input));
             input.addEventListener('input', () => {
               const errorElement = document.getElementById(`error-${input.name}`);
               if (errorElement.classList.contains('show')) {
                 validateInput(input);
               }
             });
           });
         }
         
         // Initialize the page
         async function initializePage(userData) {
           subject = userData.currentSubject;
           grade = userData.grade;
           const allQbDetails = userData.qbDetails;
         
           // Store the qb details of the current subject in the global variable
            qbDetails  = allQbDetails[subject];
         
           // Store selected qb IDs in the global variable
           selectedQbIds = userData['selectedQbIds']
         
           generateInputFields();
           addInputListeners();
           
           const form = document.getElementById('questionForm');
           form.addEventListener('submit', handleFormSubmit);
         }
         
         
         
         // Function to convert a grade number into its Roman equivalent
         function gradeToRoman(num) {
         const romanMap = [
         '', 'I', 'II', 'III', 'IV', 'V',
         'VI', 'VII', 'VIII', 'IX', 'X',
         'XI', 'XII'
         ];
         
         // Return corresponding Roman numeral or empty string if out of range
         return romanMap[num] || '___';
         }
         
                 
             // Function to get URL parameters
             function getParameterByName(name, url) {
                 if (!url) url = window.location.href;
                 name = name.replace(/[[\]]/g, '\\$&');
                 var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                     results = regex.exec(url);
                 if (!results) return null;
                 if (!results[2]) return '';
                 return decodeURIComponent(results[2].replace(/\+/g, ' '));
             }
         
             function getRandomInt(min, max) {
                 return Math.floor(Math.random() * (max - min + 1)) + min;
             }
         
             function generateWorksheet(selectedQuestions) {
         
              // Base URL
              const baseURL = "https://sourabhsuneja.github.io/jvp-spark/pages/worksheet/";
         
              // Question bank IDs
              const qbIds = selectedQbIds;
         
                 // set question counts
                 let fillUp = parseInt(selectedQuestions['Fill up']) || 0;
                 let trueFalse = parseInt(selectedQuestions['True/False']) || 0;
                 let mcq = parseInt(selectedQuestions['MCQ']) || 0;
                 let veryShortAns = parseInt(selectedQuestions['Very Short Answer Type']) || 0;
                 let shortAns = parseInt(selectedQuestions['Short Answer Type']) || 0;
                 let longAns = parseInt(selectedQuestions['Long Answer Type']) || 0;
         
                 // Randomize difficulty level
                 let difficulty = "purelyRandom";
         
         
                 // Question types
         const questionTypes = {
         "Fill up": fillUp,
         "True/False": trueFalse,
         "MCQ": mcq,
         "Very Short Answer Type": veryShortAns,
         "Short Answer Type": shortAns,
         "Long Answer Type": longAns,
         "Match items": 0,
         "image": false,
         "audio": false,
         "video": false
         };
         
         // Generate the qpm object by iterating over the qbIds
         let qpmObj = {};
         qbIds.forEach(qbId => {
         qpmObj[qbId] = { ...questionTypes };
         });
         
         // Encode the generated qpm object
         let qpm = encodeURIComponent(JSON.stringify(qpmObj));
         
                 // Exam details object
                 let ed = {
                     schoolName: "Jamna Vidyapeeth",
                     examName: "Practice Worksheet" + ((getParameterByName("solved") === "y") ? " (Solved)" : ""),
                     subject,
                     duration: 60,
                     grade: gradeToRoman(grade)
                 };
         
                 // Question container object
                 let qc = {
                     headings: [""],
                     qTypes: [{
                         "MCQ": mcq,
                         "Fill up": fillUp,
                         "True/False": trueFalse,
                         "Very Short Answer Type": veryShortAns,
                         "Short Answer Type": shortAns,
                         "Long Answer Type": longAns
                     }],
                     weightPerQ: [{}],
                     mustInclude: [{}],
                     settings: {
                         provideAnsOrSpace: (getParameterByName("solved") === "y") ? "ans" : "space",
                         randomiseSelection: true,
                         strictChapterWiseDistribution: false,
                         editable: false,
                         showAIBtns: false,
                         hideWeightage: true,
                         showStudentDetails: true,
                         border: false,
                         shuffleMCQOptions: false,
                         useDotPatternInBlanks: true,
                         showHelpBoxInFillUp: false,
                         mergeMatchItems: true,
                         convertQForm: {
                             MCQ: { toFillUp: 0, toTF: 0, toVSA: 0 },
                             flipTF: false
                         },
                         spaceForAns: {
                             "Very Short Answer Type": 1,
                             "Short Answer Type": 3,
                             "Long Answer Type": 6,
                             "Very Long Answer Type": 8,
                             "Diagram/Picture/Map Based": 6
                         },
                         qTypesAllowedInImageQ: [
                             "Short Answer Type", "Long Answer Type",
                             "Very Long Answer Type", "Diagram/Picture/Map Based"
                         ]
                     }
                 };
         
                 // URL encoding
                 let encodedEd = encodeURIComponent(JSON.stringify(ed));
                 let encodedQc = encodeURIComponent(JSON.stringify(qc));
                 let encodedQbIds = encodeURIComponent(qbIds.join("+"));
         
                 // Final URL construction
                 let finalURL = `${baseURL}?ed=${encodedEd}&qpm=${qpm}&qc=${encodedQc}&qbIds=${encodedQbIds}&diff=${difficulty}`;
         
                 // Redirect to the generated link
                 window.parent.loadManualPage({link: finalURL, title: 'Worksheet', page_key: subject + '-worksheet', min_width: 750});
             }       
      </script>
   </body>
</html>