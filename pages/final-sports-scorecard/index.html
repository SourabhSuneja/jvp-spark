<!DOCTYPE html>
<html lang="en" class="noselect">
<head>
      <!-- Google tag (gtag.js) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-T7R00N5VLE"></script>
      <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'G-T7R00N5VLE');
      </script>
      <!-- Google tag (gtag.js) -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Annual Sports Meet - Results</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Russo+One&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script type="module" src="https://myjvp.in/commons/supabase-crud.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            /* House Colors - Adjusted for better contrast */
            --ruby: #e74c3c;
            --ruby-light: #fadbd8;
            --emerald: #27ae60;
            --emerald-light: #d5f5e3;
            --sapphire: #2980b9;
            --sapphire-light: #d4e6f1;
            --topaz: #f39c12; /* Darkened slightly for text visibility */
            --topaz-light: #fdebd0;
            
            --dark: #2c3e50;
            --text-main: #34495e;
            --text-light: #7f8c8d;
            --bg-body: #f8f9fa;
            --white: #ffffff;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0,0,0,0.05);
        --ruby-primary: #ff4757;
    --ruby-secondary: #2f3542;

        --emerald-primary: #2ed573;
    --emerald-secondary: #2f3542;

    --sapphire-primary: #1e90ff;
    --sapphire-secondary: #2f3542;

    --topaz-primary: #ffa502;
    --topaz-secondary: #2f3542;

    --bg-color: #000;
        }

        * {
            max-height: 99999999px;
        }

        .noselect {
         -webkit-user-select: none;
         -moz-user-select: none;
         -ms-user-select: none;
         user-select: none;
         -webkit-touch-callout: none;
         -webkit-user-drag: none;
         -webkit-tap-highlight-color: transparent;
         }

        html {
            font-size: 14px;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* --- Header Section --- */
        header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        h1 {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            color: var(--dark);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-size: 1.8rem;
            font-weight: 700;
        }

        h2 {
            font-family: 'Poppins', sans-serif;
            margin: 5px 0 15px;
            font-weight: 500;
            color: var(--text-light);
            font-size: 1.4rem;
        }

        .meta-badges {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .meta-badge {
            font-size: 0.85rem;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- Loading Spinner --- */
        #loading-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.3s ease;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--dark);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Scoreboard Section --- */
        .scoreboard-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .score-card {
            background: var(--white);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid transparent;
            transition: transform 0.2s ease;
        }

        .score-card:hover { /*transform: translateY(-3px); */}

        .score-card h3 { 
            margin: 0; 
            font-size: 1.1rem; 
            color: var(--text-light); 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            font-weight: 600;
        }
        
        .score-card .points { 
            font-size: 3rem; 
            font-family: 'Poppins', sans-serif;
            font-weight: 700; 
            margin: 10px 0; 
            color: var(--dark); 
        }
        
        .score-card .rank { 
            font-size: 0.85rem; 
            font-weight: 600; 
            text-transform: uppercase; 
            padding: 6px 12px; 
            border-radius: 20px; 
            display: inline-block;
            background: #f1f3f5;
            color: #555;
        }

        .score-card .icon-bg {
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 5rem;
            opacity: 0.05;
            transform: rotate(15deg);
        }

        /* House Specific Styles */
        .border-Ruby { border-bottom-color: var(--ruby); }
        .border-Ruby .points { color: var(--ruby); }
        .border-Ruby .icon-bg { color: var(--ruby); }
        .badge-Ruby { background: var(--ruby-light); color: #c0392b; }

        .border-Emerald { border-bottom-color: var(--emerald); }
        .border-Emerald .points { color: var(--emerald); }
        .border-Emerald .icon-bg { color: var(--emerald); }
        .badge-Emerald { background: var(--emerald-light); color: #1e8449; }

        .border-Sapphire { border-bottom-color: var(--sapphire); }
        .border-Sapphire .points { color: var(--sapphire); }
        .border-Sapphire .icon-bg { color: var(--sapphire); }
        .badge-Sapphire { background: var(--sapphire-light); color: #1f618d; }

        .border-Topaz { border-bottom-color: var(--topaz); }
        .border-Topaz .points { color: var(--topaz); }
        .border-Topaz .icon-bg { color: var(--topaz); }
        .badge-Topaz { background: var(--topaz-light); color: #9a7d0a; }

        /* --- Final Judgement (Podium) --- */
        .winner-banner {
            background: linear-gradient(135deg, var(--dark) 0%, #34495e 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: var(--border-radius);
            margin-bottom: 40px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .winner-banner i { font-size: 2rem; color: #f1c40f; }
        .winner-text { font-size: 1.1rem; }
        .winner-text strong { color: #f1c40f; font-size: 1.1rem; }

        /* --- Data Table --- */
        .table-container {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 40px;
        }

        .table-responsive {
            overflow-x: auto;
            max-height: 80vh;  /* Limits table height to 75% of viewport */
            overflow-y: auto;  /* Enables vertical scrolling inside the table */
            border-bottom: 1px solid #ddd; /* Optional: adds definition at bottom */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
            font-size: 16px;
        }

        thead {
            background-color: var(--dark);
            color: var(--white);
        }

        th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 500;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
            text-transform: uppercase;
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: var(--dark); /* Essential: ensures header is opaque */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Optional: Adds a subtle shadow */
        }

        td {
            padding: 16px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
            vertical-align: top;
            font-size: 0.95rem;
        }

        tr:last-child td { border-bottom: none; }
        tr:not(:first-child):hover { background-color: #f8fcfd; }


        .game-col { font-weight: 600; color: var(--dark); font-family: 'Poppins', sans-serif;}
        
        /* Inner cell styling */
        .winner-cell { display: flex; flex-direction: column; gap: 4px; }
        .winner-name { font-weight: 600; color: #333; }
        
        .house-badge-pill {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            width: fit-content;
        }
        
        .bg-Ruby { background-color: var(--ruby); color: white; }
        .bg-Emerald { background-color: var(--emerald); color: white; }
        .bg-Sapphire { background-color: var(--sapphire); color: white; }
        .bg-Topaz { background-color: var(--topaz); color: white; }
        .bg-NIL { background-color: #e0e0e0; color: #888; }

        /* Game Type Badges */
        .badge {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .badge-Team { background: #e8daef; color: #8e44ad; }
        .badge-Ind { background: #d6eaf8; color: #2980b9; }
        .badge-Grp { background: #d1f2eb; color: #16a085; }

        /* --- Signatures --- */
        .signatures {
            margin-top: 60px;
            display: flex;
            justify-content: space-around;
            padding-top: 20px;
            page-break-inside: avoid;
        }

        .sig-block {
            text-align: center;
            width: 200px;
        }
        
        .sig-line {
            width: 100%;
            height: 1px;
            background-color: #ccc;
            margin-bottom: 10px;
        }

        .sig-block p { margin: 5px 0; font-size: 1rem; font-weight: 700; color: var(--dark); font-family: 'Poppins', sans-serif;}
        .sig-block span { display: block; font-size: 0.85rem; color: #777; font-weight: 500; }

        /* --- Print Button --- */
        .action-bar {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        .btn-print {
            padding: 10px 20px;
            background: var(--dark);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        .btn-print:hover { background: #34495e; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

        /* --- PRINT STYLES --- */
        @media print {
            body { background-color: white; font-size: 10pt; color: #000; }
            .container { width: 100%; max-width: 100%; padding: 0; margin: 0; }
            .action-bar, #loading-overlay { display: none !important; }
            
            header { margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 15px; }
            h1 { font-size: 1.8rem; color: #000; }
            h2 { font-size: 1.2rem; color: #333; margin-bottom: 5px;}
            
            .meta-badge { border: 1px solid #ccc; color: #000 !important; background: transparent !important; }
            
            /* Scoreboard Print */
            .scoreboard-section { gap: 10px; margin-bottom: 20px; }
            .score-card { 
                box-shadow: none; 
                border: 1px solid #ccc; 
                padding: 10px; 
                break-inside: avoid;
                page-break-inside: avoid;
            }
            .score-card .points { font-size: 1.8rem; color: #000 !important; }
            .score-card h3 { color: #000; font-size: 1rem; }
            .score-card .rank { background: transparent; border: 1px solid #ddd; }
            .score-card .icon-bg { display: none; }
            
            /* Winner Banner Print */
            .winner-banner { 
                background: white; 
                border: 2px solid #000; 
                color: black; 
                box-shadow: none; 
                padding: 10px;
            }
            .winner-banner i { display: none; }
            .winner-banner strong { color: black !important; text-decoration: underline; }

            /* Table Print */
            .table-container { box-shadow: none; }
            .table-responsive { overflow: visible; }
            table { width: 100%; border: 1px solid #000; }
            thead { background-color: #eee !important; color: black !important; -webkit-print-color-adjust: exact; }
            th { border-bottom: 2px solid #000; padding: 8px; font-size: 0.85rem; }
            td { border-bottom: 1px solid #ccc; padding: 6px 8px; font-size: 0.85rem; }
            
            /* Ensure colors print slightly for identification or fallback to borders */
            .house-badge-pill { 
                border: 1px solid #999; 
                color: black !important; 
                background: white !important; 
                font-weight: bold;
                padding: 1px 4px;
            }
            
            /* Add letter indicators for B/W printing clarity */
            .bg-Ruby::after { content: " (R)"; font-size: 0.8em; }
            .bg-Emerald::after { content: " (E)"; font-size: 0.8em; }
            .bg-Sapphire::after { content: " (S)"; font-size: 0.8em; }
            .bg-Topaz::after { content: " (T)"; font-size: 0.8em; }

            .signatures { margin-top: 40px; }
            .sig-line { background-color: #000; }

            tr { break-inside: avoid; page-break-inside: avoid; }
        }
    </style>
    <style>
        /* --- Overlay Container --- */
        #winner-overlay {
            font-family: 'Poppins', sans-serif;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.5s ease;
            backdrop-filter: blur(8px);
            background: radial-gradient(circle at center, var(--bg-color), #000000 90%);
        }

        #winner-overlay.active {
            display: flex;
            opacity: 1;
        }

        /* --- Winner Card (Glassmorphism) --- */
        .winner-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 3rem 4rem;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 0 0 1px rgba(255,255,255,0.1);
            transform: scale(0.8);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            max-width: 90%;
            box-shadow: 4px 4px 15px #fffffe;
        }

        #winner-overlay.active .winner-card {
            transform: scale(1);
            opacity: 1;
        }

        /* Decorative Shine on Card */
        .winner-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            20% { left: 100%; }
            100% { left: 100%; }
        }

        /* --- Icons & Text --- */
        .trophy-container {
            font-size: 6rem;
            margin-bottom: 1rem;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.3));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .congrats-text {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .house-title {
            font-family: 'Russo One', sans-serif;
            font-size: 5rem;
            line-height: 1.1;
            margin: 10px 0;
            text-transform: uppercase;
            color: #fff;
            text-shadow: 0 5px 15px rgba(0,0,0,0.3);
            background-clip: text;
            -webkit-background-clip: text;
            letter-spacing: 2px;
        }

        .score-badge {
            display: inline-block;
            background: rgba(0, 0, 0, 0.4);
            padding: 0.8rem 2rem;
            border-radius: 50px;
            font-size: 1.8rem;
            color: #fff;
            margin-top: 1.5rem;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .score-value {
            font-family: 'Russo One', sans-serif;
            color: #fff;
            margin-left: 10px;
        }

        /* --- Dynamic Theme Classes --- */
        .theme-ruby .trophy-container { color: var(--ruby-primary); }
        .theme-ruby .house-title { text-shadow: 0 0 30px var(--ruby-primary); }
        .theme-ruby .score-value { color: var(--ruby-primary); }

        .theme-emerald .trophy-container { color: var(--emerald-primary); }
        .theme-emerald .house-title { text-shadow: 0 0 30px var(--emerald-primary); }
        .theme-emerald .score-value { color: var(--emerald-primary); }

        .theme-sapphire .trophy-container { color: var(--sapphire-primary); }
        .theme-sapphire .house-title { text-shadow: 0 0 30px var(--sapphire-primary); }
        .theme-sapphire .score-value { color: var(--sapphire-primary); }

        .theme-topaz .trophy-container { color: var(--topaz-primary); }
        .theme-topaz .house-title { text-shadow: 0 0 30px var(--topaz-primary); }
        .theme-topaz .score-value { color: var(--topaz-primary); }

        /* --- Close Button --- */
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.5);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
            z-index: 10;
            display: none;
        }
        .close-btn:hover { color: white; }

        /* --- Mobile Responsive --- */
        @media (max-width: 600px) {
            .winner-card { padding: 2rem; width: 85%; }
            .house-title { font-size: 3rem; }
            .trophy-container { font-size: 4rem; }
            .score-badge { font-size: 1.2rem; padding: 0.5rem 1.5rem; }
        }
    </style>

</head>
<body>

<div id="loading-overlay">
    <div class="spinner"></div>
    <div style="font-weight: 500; color: #555;">Fetching Winners...</div>
</div>

<div class="container">

    <header>
        <h1>Jamna Vidyapeeth<br><i class="fas fa-medal" style="color: var(--topaz); margin-right: 10px;"></i> </h1>
        <h2>Annual Sports Meet 2025-26</h2>
        <div class="meta-badges">
            <span class="meta-badge badge-Ruby"><i class="fas fa-shield-alt"></i> Ruby</span>
            <span class="meta-badge badge-Emerald"><i class="fas fa-shield-alt"></i> Emerald</span>
            <span class="meta-badge badge-Sapphire"><i class="fas fa-shield-alt"></i> Sapphire</span>
            <span class="meta-badge badge-Topaz"><i class="fas fa-shield-alt"></i> Topaz</span>
        </div>
    </header>

    <div class="scoreboard-section" id="scoreboard">
        </div>

    <div id="winner-banner-container">
        </div>

    <div class="table-container">
        <div class="table-responsive">
            <table id="resultsTable">
                <thead>
                    <tr>
                        <th style="width: 25%">Game / Event</th>
                        <th style="width: 10%">Type</th>
                        <th style="width: 8%">Class</th>
                        <th style="width: 19%"><i class="fas fa-trophy" style="color: #f1c40f"></i> 1st Position</th>
                        <th style="width: 19%"><i class="fas fa-medal" style="color: #95a5a6"></i> 2nd Position</th>
                        <th style="width: 19%"><i class="fas fa-medal" style="color: #cd7f32"></i> 3rd Position</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>
</div>

      <!-- Winner Overlay starts -->
      <div id="winner-overlay">
         <div class="winner-card" id="winner-card">
            <button class="close-btn" onclick="hideWinner()"><i class="fa-solid fa-xmark"></i></button>
            <div class="trophy-container">
               <i class="fa-solid fa-trophy"></i>
            </div>
            <div class="congrats-text">Victory Goes To</div>
            <div class="house-title" id="house-name">HOUSE NAME</div>
            <div class="score-badge">
               TOTAL SCORE <span class="score-value" id="score-val">0000</span>
            </div>
         </div>
      </div>
      <!-- Winner Overlay ends -->

<script>
    // --- 1. DATA SOURCE ---
    let winners = [];

    // --- 2. LOGIC CONFIGURATION ---
    const housePoints = {
        "Ruby": 0,
        "Emerald": 0,
        "Sapphire": 0,
        "Topaz": 0
    };

    const rules = {
        standard: { 1: 10, 2: 7, 3: 5 }, // Individual & Grouped
        team: { 1: 20, 2: 14, 3: 0 }     // Team events
    };

    // --- 3. PROCESSING FUNCTIONS ---

    function calculatePoints() {
        // Reset points
        Object.keys(housePoints).forEach(h => housePoints[h] = 0);

        winners.forEach(event => {
            const isTeam = event.gametype.toLowerCase() === 'team';
            const pointsRule = isTeam ? rules.team : rules.standard;

            // Helper to process a specific position (1, 2, or 3)
            const processPosition = (houseString, position) => {
                // If Team event, there is no 3rd place points
                if (isTeam && position === 3) return; 

                if (!houseString || houseString === "NIL") return;

                // Handle split winners (e.g. "Ruby/Emerald")
                const winnersList = houseString.split('/').map(s => s.trim());
                
                winnersList.forEach(house => {
                    if (housePoints.hasOwnProperty(house)) {
                        housePoints[house] += pointsRule[position];
                    }
                });
            };

            processPosition(event.winnerhouse1, 1);
            processPosition(event.winnerhouse2, 2);
            processPosition(event.winnerhouse3, 3);
        });
    }

    function renderTable() {
        const tbody = document.querySelector("#resultsTable tbody");
        tbody.innerHTML = "";

        winners.forEach(row => {
            // Determine badge type for styling
            let typeBadge = "badge-Ind";
            if(row.gametype === 'Team') typeBadge = "badge-Team";
            else if(row.gametype === 'Grouped') typeBadge = "badge-Grp";

            // Helper to format winner cell
            const formatWinnerCell = (name, house) => {
                if(house === 'NIL') return '<span style="color:#ccc; font-size:0.85rem">NIL</span>';
                
                // Handle multiple houses for display badges
                const houses = house.split('/').map(h => h.trim());
                let badges = houses.map(h => `<span class="house-badge-pill bg-${h}">${h}</span>`).join(' ');
                
                return `
                    <div class="winner-cell">
                        <div class="winner-name">${name}</div>
                        <div>${badges}</div>
                    </div>
                `;
            };

            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td class="game-col">${row.game}</td>
                <td><span class="badge ${typeBadge}">${row.gametype}</span></td>
                <td style="font-weight:500;">${row.classcategory}</td>
                <td>${formatWinnerCell(row.winner1, row.winnerhouse1)}</td>
                <td>${formatWinnerCell(row.winner2, row.winnerhouse2)}</td>
                <td>${formatWinnerCell(row.winner3, row.winnerhouse3)}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    function renderScoreboard() {
        const board = document.getElementById('scoreboard');
        board.innerHTML = "";

        // Convert object to array for sorting
        const sortedHouses = Object.entries(housePoints).sort((a, b) => b[1] - a[1]);

        // Calculate Rank (handle ties)
        let currentRank = 1;
        
        sortedHouses.forEach((item, index) => {
            const [house, points] = item;
            
            // Check for tie with previous
            if (index > 0 && points < sortedHouses[index-1][1]) {
                currentRank = index + 1;
            }

            const card = document.createElement('div');
            card.className = `score-card border-${house}`;
            
            // Add icon depending on rank
            let icon = 'fa-shield-alt';
            if(currentRank === 1) icon = 'fa-trophy';
            
            card.innerHTML = `
                <i class="fas ${icon} icon-bg"></i>
                <h3>${house} House</h3>
                <div class="points">${points}</div>
                <div class="rank">Rank ${currentRank}</div>
            `;
            board.appendChild(card);
        });

        // Update Final Judgement Banner
        const banner = document.getElementById('winner-banner-container');
        const winnerName = sortedHouses[0][0];
        const winnerPoints = sortedHouses[0][1];
        
        // Check if there is a tie for 1st place
        let winnersText = `${winnerName} House`;
        if (sortedHouses.length > 1 && sortedHouses[1][1] === winnerPoints) {
            winnersText += ` & ${sortedHouses[1][0]} House`;
        }

        banner.innerHTML = `
            <div class="winner-banner">
                <i class="fas fa-crown"></i>
                <div class="winner-text">
                    Congratulations to <strong>${winnersText}</strong> for winning with <strong>${winnerPoints} points</strong>!
                </div>
                <i class="fas fa-crown"></i>
            </div>
        `;
    }

    // --- 4. INITIALIZATION ---
    window.onload = async function() {
        const loader = document.getElementById('loading-overlay');
        try {
            winners = await selectData('sport_winners', false, '*', [], [], 'classcategory');
            calculatePoints();
            renderScoreboard();
            renderTable();
        } catch (error) {
            console.error("Error fetching data:", error);
            alert("Failed to load data. Please refresh.");
        } finally {
            // Hide loader with a slight fade effect
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
            }, 300);
        }
    };

</script>
    <script>
        // Configuration for House Colors
        const houseConfig = {
            'Ruby': { 
                primary: '#ff4757', 
                colors: ['#ff4757', '#ff6b81', '#ffffff'] 
            },
            'Emerald': { 
                primary: '#2ed573', 
                colors: ['#2ed573', '#7bed9f', '#ffffff'] 
            },
            'Sapphire': { 
                primary: '#1e90ff', 
                colors: ['#1e90ff', '#70a1ff', '#ffffff'] 
            },
            'Topaz': { 
                primary: '#ffa502', 
                colors: ['#ffa502', '#eccc68', '#ffffff'] 
            }
        };

        const overlay = document.getElementById('winner-overlay');
        const card = document.getElementById('winner-card');
        const houseNameEl = document.getElementById('house-name');
        const scoreEl = document.getElementById('score-val');

        function triggerWin(houseName, score) {
            const config = houseConfig[houseName] || houseConfig['Topaz'];
            
            // 1. Set Content
            houseNameEl.innerText = houseName;
            scoreEl.innerText = score;
            
            // 2. Set Theme Colors via CSS Variables
            // We set the background glow to the house color, but dark/subtle
            document.documentElement.style.setProperty('--bg-color', shadeColor(config.primary, -60));
            
            // 3. Reset Classes
            card.className = 'winner-card';
            card.classList.add(`theme-${houseName.toLowerCase()}`);

            // 4. Show Overlay
            overlay.classList.add('active');

            // 5. Fire Confetti (Canvas Confetti Library)
            fireConfetti(config.colors);
        }

        function hideWinner() {
            overlay.classList.remove('active');
        }

        // --- Confetti Logic ---
        function fireConfetti(colors) {
            // Burst 1: Center
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: colors,
                zIndex: 10000
            });

            // Burst 2: Side Cannons (School Pride)
            var end = Date.now() + 4000; // Run for a long time

            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: colors,
                    zIndex: 10000
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: colors,
                    zIndex: 10000
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }

        // Helper to darken colors for background
        function shadeColor(color, percent) {
            var R = parseInt(color.substring(1,3),16);
            var G = parseInt(color.substring(3,5),16);
            var B = parseInt(color.substring(5,7),16);

            R = parseInt(R * (100 + percent) / 100);
            G = parseInt(G * (100 + percent) / 100);
            B = parseInt(B * (100 + percent) / 100);

            R = (R<255)?R:255;  
            G = (G<255)?G:255;  
            B = (B<255)?B:255;  

            var RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
            var GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
            var BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));

            return "#"+RR+GG+BB;
        }
        triggerWin('Topaz', 784);
        setTimeout(hideWinner, 3000);
    </script>

</body>
</html>
